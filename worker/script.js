!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var r=Object.defineProperty,a=(e,t,n)=>(((e,t,n)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),i=(e,t)=>{e=new URL(String(e));for(const[n,r]of Object.entries(t))e.searchParams.append(n,r);return String(e)},s=e=>{if(!e.ok)throw new Error("unexpected status code: "+e.status);return e};function o(e,t){const n=this;return function(...r){return Promise.race([e.call(n,...r),new Promise((e,n)=>{setTimeout(()=>{n(new Error("timed out"))},t)})])}}var c=async(e,t)=>s(await o(fetch,5e3)(e,t)).text(),l=async(e,t)=>s(await o(fetch,5e3)(e,t)).json(),u=async e=>{var t;const n=null!=(t=e.headers.get("cf-connecting-ip"))?t:"";return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",(new TextEncoder).encode(n)))).map(e=>e.toString(16).padStart(2,"0")).join("").slice(0,5)},d=class{async getBestMatched({rawName:e,rawArtist:t}){const n=e.toLowerCase(),r=t.toLowerCase(),a=String.fromCodePoint(r.codePointAt(0));return c(new URL(`${encodeURI(a)}/${encodeURI(r)}/${encodeURI(n)}.lrc`,"https://raw.githubusercontent.com/lujjjh/lyrics/main/lyrics/").toString())}},f="https://music.163.com/api/",g={"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36",cookie:"NMTID="},m=class{async getArtistInfo(e){const{result:{artists:t}}=await l(i(new URL("search/pc",f),{s:e,limit:"1",type:"100"}),{headers:g}),n=null==t?void 0:t[0];if(n)return{id:n.id,name:n.name}}async getBestMatched({name:e,artist:t}){var n;const r=await this.getArtistInfo(t);if(!r)return;const{result:{songs:a}}=await l(i(new URL("search/pc",f),{s:[e,r.name].join(" "),limit:"50",type:"1"}),{headers:g}),s=a.filter(({artists:e})=>{var t;return(null==(t=null==e?void 0:e[0])?void 0:t.id)===r.id}),o=null!=(n=s.find(t=>String(t.name).includes(e)))?n:s[0];if(!o)return;const{lrc:c}=await l(i(new URL("song/lyric",f),{id:String(o.id),lv:"1"}));return c?c.lyric:void 0}},w="https://c.y.qq.com/",p=class{async getArtistInfo(e){var t;const{data:{singer:n}}=await l(i(new URL("splcloud/fcgi-bin/smartbox_new.fcg",w),{key:e})),r=null==(t=null==n?void 0:n.itemlist)?void 0:t[0];if(r)return{mid:r.mid,name:r.name}}async getBestMatched({name:e,artist:t}){const n=await this.getArtistInfo(t);if(!n)return;const{data:{song:{list:r}}}=await l(i(new URL("soso/fcgi-bin/client_search_cp",w),{format:"json",w:[e,n.name].join(" "),n:"10"}));if(!r)return;const a=r.filter(({singer:e})=>{var t;return(null==(t=null==e?void 0:e[0])?void 0:t.mid)===n.mid}).find(({songname_hilight:e})=>String(e).includes("<em>"));if(!a)return;const{lyric:s}=await l(i(new URL("lyric/fcgi-bin/fcg_query_lyric_new.fcg",w),{format:"json",nobase64:"1",songmid:a.songmid}),{headers:{referer:"https://y.qq.com/"}});return s?String(s):void 0}},h=class{constructor(){a(this,"removeTags",e=>{if(null===e||""===e)return!1;const t=(e=e.toString().replace(/(<([^>]+)>)/gi,"").replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&quot;/g,'"').replace(/^\s*\n\n/gm,"").replace(/&#039;/g,"'").replace(/&amp;/g,"&")).split("\n");var n;return n=[],t.forEach(e=>{e.substring(0,9).includes(".")&&n.push(e)}),n.join("\n")})}async getLink(e,t){const n=e+" "+t,r=(await c("https://www.lyricsify.com/search?q="+n)).toString().split('<div class="li">');var a;return r.slice(1,r.length).forEach(n=>{const r=n.match(">(.*?)<"),i=n.match('href="([^"]*)"');(null==r?void 0:r.length)&&(null==i?void 0:i.length)&&r[1].toLowerCase().includes(e)&&r[1].toLowerCase().includes(t)&&(a=i[1])}),a}async getLrc(e){const t=(await c("https://www.lyricsify.com/"+e)).toString().match(/<div id="entry"[^>]*>(.+?)<\/div>/is);if(null==t?void 0:t.length){return this.removeTags(t[1]).toString()}}async getBestMatched({rawName:e,rawArtist:t}){const n=e.toLowerCase(),r=t.toLowerCase(),a=await this.getLink(r,n);if(a){return await this.getLrc(a)}return""}},y=caches.default;addEventListener("fetch",e=>{e.respondWith(b(e))});var v=()=>new Response("Not found",{status:404,headers:{"content-type":"text/plain","cache-control":"no-cache"}}),b=async e=>{const{request:t}=e,{pathname:n}=new URL(t.url);if("GET"!==t.method)return v();switch(n){case"/user":return L(e);case"/":return S(e);default:return v()}},L=async e=>new Response(JSON.stringify({user_id:await u(e.request)}),{headers:{"content-type":"application/json","cache-control":"no-cache"}}),S=async e=>{var t,n;const{request:r}=e,{searchParams:a}=new URL(e.request.url),i=null==(t=a.get("name"))?void 0:t.trim(),s=null==(n=a.get("artist"))?void 0:n.trim();if(!i||!s)return v();let o=await y.match(r);o||(o=await j({name:i,artist:s}),e.waitUntil(y.put(r,o.clone())));o.status,await u(r);return o},j=async e=>{var t,n;const r=e.name,a=e.artist,i=null==(t=r.replace(/\([^)]+\)/g,""))?void 0:t.trim(),s=null==(n=a.replace(/[,&].*/,""))?void 0:n.trim();if(!i||!s)return v();const o=[new h,new d,new p,new m].map(e=>e.getBestMatched({name:i,artist:s,rawName:r,rawArtist:a}).catch(()=>{}));for await(const e of o)if(e){return new Response(e.replaceAll(/^\s*(\[\d{2}.\d{2}.)(\d{2})\d(\])/gm,(e,t,n,r)=>t+n+r),{headers:{"content-type":"text/plain; charset=utf-8","cache-control":"max-age=2592000, s-maxage=31536000, stale-while-revalidate=2592000"}})}return v()}}]);